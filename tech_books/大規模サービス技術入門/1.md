# 第 1 回. 大規模 Web サービスの開発オリエンテーション

## 本の構成

- 第 2-5 回: 大規模データを扱うアプリケーション開発に必要な前提知識
- 第 6-10 回: 実装より。アルゴリズムのお話。
- 第 11-15 回: インフラのお話。

## 2010 年のはてなの規模(大規模)

- サーバ 500 台(ラック 20 台)、仮想化を使っていて、ホストは 1000 台
- ピーク時の回線トラフィックは 430Mbps
- １日のアクセスログは基本的にギガバイト級
- DB サーバのデータ規模もギガバイト〜テラバイト級
- 数十億アクセス/月

## 2010 年の超大規模システム

- サーバー台数は数百万規模
- 扱うデータはテラバイト〜ペタバイト

## 大規模システムに求められるもの

- 負荷分散のためにスケールアウト
- 冗長性の確保
- 各サーバの運用やヘルスチェック、監視
- 開発人数や開発方法の変化
- データ量の増加への対処

# 第 2 回. 大規模データ処理入門

## はてなブックマークのデータ規模

- entry テーブル: 1520 万レコードで 3GB
- bookmark テーブル: 4500 万レコードで 5.5GB

ということは、1 レコード 100byte くらいか？

## 5. 大規模データ処理の難所(メモリとディスク)

### メモリと HDD

- 特定の箇所のデータにアクセスするのに、ディスクはメモリの 10 万 −100 万灰の時間がかかる
- メモリは電気的な部品で、マイクロ秒単位(10 のマイナス 6 乗単位)でポインタを動かすことができる
- ディスクは円盤が回転していてヘッダで時期を読み出す(円盤の回転、ヘッドの移動それぞれミリ秒単位の時間がかかる物理的移動)
- メモリ →CPU, ディスク →CPU のバスの転送速度は 7.5GB/s, 58MB/s

### HDD

- ディスクからの読み取りを速くするために、OS は連続した(似たような)データを同じような場所に固める
- データを読み出すときに、1byte ずつ読み出すのではなく、4KB くらいをどかっと読む
- ちなみに、SSD だと物理的な回転はないので、探索の時間は短くなるが、バスの転送速度がボトルネックになったりする

### サーバのボトルネック見極めの流れ

- ロードアベレージを見る

  - Load Average とは`平均的にどれだけのタスク（ほぼプロセスと同義）が実行待ちとなっているかということ`を表します。ここでの実行待ちとは、以下の 2 つが該当します。
    - CPU の実行権限が与えられているのを待っているタスク
    - ディスク I/O が完了するのを待っているタスク
  - `uptime`はロードアベレージだけを確認。`top`はメモリ・プロセス・CPU など、幅広い情報を確認できます。
  - ロードアベレージは基本的に CPU のコア数よりも低ければ、問題ないレベルと言える

- CPU 負荷 と I/O 負荷 のどちらがボトルネック かを探る

## 6. スケーリングの要所

- スケールアップよりスケールアウトの方が一般的
- DB サーバなど I/O 負荷のスケーリングは難しい
  - 書き込みでは、データの同期性の確保が難しいから
  - そもそもディスクへの I/O は時間かかる。。。(理由になってないが)

## 7. 大規模データを使うための基礎知識

- 3つの勘所

  - いかにメモリで済ませるか
  - データ量の増加に強いアルゴリズムやデータ構造を使う
  - データ圧縮、検索技術を使う
    - 検索技術はアプリケーションから使うらしい

- これらのさらに土台の知識として、第 3−5 章では、以下を取り上げていく

  - OS のキャッシュ層
  - 分散を考慮した RDBMS の運用
  - アルゴリズムとデータ構造

# 第 3 章、OS のキャッシュと分散

-
